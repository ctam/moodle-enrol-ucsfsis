define(["jquery","core/ajax","core/notification"],function(a,b,c){return{cache:{courses:{},subjects:{}},courseId:null,termId:null,coursesDefaultOptionText:"",subjectsDefaultOptionText:"",$termSelect:null,$subjectSelect:null,$courseSelect:null,init:function(b,c,d,e,f,g){this.$termSelect=a("#id_selectterm"),this.$subjectSelect=a("#id_selectsubject"),this.$courseSelect=a("#id_selectcourse"),this.courseId=b,this.termId=c,this.subjectsDefaultOptionText=f,this.coursesDefaultOptionText=g,this.cacheSubjectsAndCourses(this.termId,d,e),this.$termSelect.change(a.proxy(this,"changeTerm")),this.$subjectSelect.change(a.proxy(this,"changeSubject")),this.enableForm()},changeSubject:function(b){var c=a(b.target).find(":selected").val(),d=this.cache.courses[this.termId][c];this.repopulateSelect(this.$courseSelect,d,this.coursesDefaultOptionText)},changeTerm:function(d){this.disableForm();var e=a(d.target).find(":selected").val();this.termId=e,this.cache.subjects.hasOwnProperty(this.termId)?(this.repopulateSelect(this.$subjectSelect,this.cache.subjects[this.termId],this.subjectsDefaultOptionText),this.repopulateSelect(this.$courseSelect,[],this.coursesDefaultOptionText),this.enableForm()):b.call([{methodname:"enrol_ucsfsis_get_subjects_and_courses_by_term",args:{courseid:this.courseId,termid:e},done:this.processResponse.bind(this,e),fail:c.exception}])},processResponse:function(a,b){this.cacheSubjectsAndCourses(a,b.subjects,b.courses),this.repopulateSelect(this.$subjectSelect,b.subjects,this.subjectsDefaultOptionText),this.repopulateSelect(this.$courseSelect,[],this.coursesDefaultOptionText),this.enableForm()},enableForm:function(){a("#id_status").prop("disabled",!1),this.$termSelect.prop("disabled",!1),this.$subjectSelect.prop("disabled",!1),this.$courseSelect.prop("disabled",!1),a("#id_roleid").prop("disabled",!1),a("#id_submitbutton").prop("disabled",!1)},disableForm:function(){a("#id_status").prop("disabled",!0),this.$termSelect.prop("disabled",!0),this.$subjectSelect.prop("disabled",!0),this.$courseSelect.prop("disabled",!0),a("#id_roleid").prop("disabled",!0),a("#id_submitbutton").prop("disabled",!0)},repopulateSelect:function(b,c,d){b.children().remove().end(),b.append(a("<option>",{value:"",text:d})),a.each(c,function(c,d){b.append(a("<option>",{value:d.id,text:d.title}))})},cacheSubjectsAndCourses:function(a,b,c){var d,e,f;for(this.cache.subjects[a]=b,this.cache.courses[a]={},e=0,f=c.length;e<f;e++)d=c[e],this.cache.courses[a].hasOwnProperty(d.subjectId)||(this.cache.courses[a][d.subjectId]=[]),this.cache.courses[a][d.subjectId].push(d)}}});